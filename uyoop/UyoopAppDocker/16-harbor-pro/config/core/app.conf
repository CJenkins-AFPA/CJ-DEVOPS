# Harbor Core Application Configuration - Production
# For reference: https://goharbor.io/docs/

protocol: https
https_cert: /etc/harbor/tls/tls.crt
https_key: /etc/harbor/tls/tls.key

# Hostname for the application
hostname: harbor-core

# HTTP configuration
http:
  addr: :8080

# Database configuration
database:
  type: postgresql
  ssl_mode: disable
  max_idle_conns: 100
  max_open_conns: 900

# Redis configuration
redis:
  db_index: 0
  password: ${REDIS_PASSWORD}
  namespace: harbor

# Jobservice configuration
jobservice:
  max_job_workers: 50
  job_loggers:
    - stdout
    - file
  logger_sweeper_duration: 168

# Registry configuration
registry:
  storage_provider_name: s3
  username: ${REGISTRY_CREDENTIAL_USERNAME}
  password: ${REGISTRY_CREDENTIAL_PASSWORD}

# Log configuration
log:
  level: ${LOG_LEVEL}
  format: json

# Authentication configuration
auth_mode: oidc_auth  # Change to ldap_auth, db_auth, uaa_auth as needed

# LDAP authentication
ldap:
  url: ${LDAP_URL}
  search_dn: ${LDAP_SEARCHDN}
  search_filter: ${LDAP_SEARCH_FILTER}
  uid: ${LDAP_UID}
  timeout: 5
  verify_cert: true
  additional_tlscerts: []

# OIDC authentication
oidc:
  name: ${OIDC_NAME}
  endpoint: ${OIDC_ENDPOINT}
  client_id: ${OIDC_CLIENT_ID}
  client_secret: ${OIDC_CLIENT_SECRET}
  scope: ${OIDC_SCOPE}
  verify_cert: true
  auto_onboard: true
  user_claim: ${OIDC_USER_CLAIM}
  groups_claim: ${OIDC_GROUPS_CLAIM}

# Token configuration
token:
  expiration: ${TOKEN_EXPIRATION}
  issuer: "harbor-core"

# RBAC configuration
rbac:
  clean_up_job_purge_delay: 168

# Session configuration
session:
  timeout: ${SESSION_TIMEOUT}

# Email configuration
email:
  host: ${SMTP_HOST}
  port: ${SMTP_PORT}
  username: ${SMTP_USERNAME}
  password: ${SMTP_PASSWORD}
  from: ${SMTP_FROM}
  ssl: true
  insecure: ${SMTP_INSECURE}

# Notification configuration
notification:
  webhook_job_max_retry: 10
  webhook_job_status_hook_event_types:
    - pushImage
    - pullImage
    - deleteImage
    - uploadChart
    - downloadChart
    - deleteChart
    - scanningCompleted
    - scanningFailed

# Webhook configuration
webhook:
  host: ${WEBHOOK_HOST}
  port: ${WEBHOOK_HOST_PORT}

# Metrics configuration
metrics:
  enable: true
  path: /metrics
  port: 9090

# Trace configuration
trace:
  enabled: false
  sample_rate: 1.0
  jaeger:
    endpoint: http://jaeger:14268/api/traces
    agent_host: jaeger
    agent_port: 6831

# Cache configuration
cache:
  expiration_seconds: 3600

# OCI signature configuration
storage:
  max_blob_size: 5368709120  # 5GB

# Security context
security:
  default_token_expiration: 30
  with_notary: true
  enable_profile: ${ENABLE_PROFILE}
  enable_metrics: ${ENABLE_METRICS}
